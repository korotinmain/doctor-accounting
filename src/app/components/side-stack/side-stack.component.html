<div class="side-stack">
  <mat-card class="panel mini day-overview">
    <header class="day-overview__header">
      <div class="day-overview__title-group">
        <mat-icon class="day-overview__icon">analytics</mat-icon>
        <div class="day-overview__title-copy">
          <h3>Огляд дня</h3>
          <p>{{ todayLabel }}</p>
        </div>
      </div>
    </header>

    <div *ngIf="!monthLoading; else sideLoadingState">
      <!-- ─ Статистика ──────────────────────────────────────────────── -->
      <section class="overview-stats">
        <div class="overview-stats__summary">
          <span>Візитів {{ activeStatsLabel }}</span>
          <strong>{{ visitLabel(todayStats.visits) }}</strong>
        </div>

        <article class="overview-metric overview-metric--income">
          <span class="overview-metric__label">
            <mat-icon>person</mat-icon>
            Дохід лікаря
          </span>
          <strong>{{ todayStats.doctorIncome | currency: 'UAH' : 'symbol' : '1.0-0' : 'uk-UA' }}</strong>
        </article>

        <article class="overview-metric overview-metric--total">
          <span class="overview-metric__label">
            <mat-icon>payments</mat-icon>
            Загальна каса
          </span>
          <strong>{{ todayStats.totalAmount | currency: 'UAH' : 'symbol' : '1.0-0' : 'uk-UA' }}</strong>
        </article>
      </section>

      <!-- ─ Календар ──────────────────────────────────────────────── -->
      <div class="day-overview__divider"></div>

      <section class="overview-calendar">
        <p class="overview-calendar__label">Календар &mdash; {{ calendarMonthTitle }}</p>

        <div class="overview-calendar__weekdays">
          <span *ngFor="let label of weekdayLabels">{{ label }}</span>
        </div>

        <div class="overview-calendar__grid">
          <button
            type="button"
            class="overview-calendar__cell"
            *ngFor="let cell of calendarCells; trackBy: trackByCell"
            [disabled]="cell.type === 'empty' || (cell.type === 'day' && !cell.hasVisits && !cell.isToday)"
            [class.overview-calendar__cell--empty]="cell.type === 'empty'"
            [class.overview-calendar__cell--has-visits]="cell.type === 'day' && cell.hasVisits"
            [class.overview-calendar__cell--today]="cell.type === 'day' && cell.isToday && !isDaySelected(cell.day)"
            [class.overview-calendar__cell--selected]="cell.type === 'day' && isDaySelected(cell.day)"
            (click)="cell.type === 'day' && (cell.hasVisits || cell.isToday) && selectDay(cell.day)"
          >
            <ng-container *ngIf="cell.type === 'day'">{{ cell.day }}</ng-container>
          </button>
        </div>

        <p class="overview-calendar__hint" *ngIf="!selectedDay">Натисніть на день, щоб побачити статистику</p>
        <p class="overview-calendar__hint overview-calendar__hint--active" *ngIf="selectedDay">
          Показано: {{ activeStatsLabel }} &mdash;
          <button type="button" class="overview-calendar__reset" (click)="selectedDay = null">скинути</button>
        </p>
      </section>

      <!-- ─ Дії ──────────────────────────────────────────────────── -->
      <div class="day-overview__divider"></div>

      <section class="overview-actions">
        <button type="button" class="overview-actions__btn overview-actions__btn--primary" (click)="exportData()">
          <mat-icon>download</mat-icon>
          Експорт даних
        </button>

        <button type="button" class="overview-actions__btn" (click)="printReport()">
          <mat-icon>print</mat-icon>
          Друк звіту
        </button>

        <p>Дані за {{ calendarMonthLabel }}.</p>
      </section>
    </div>

    <ng-template #sideLoadingState>
      <div class="overview-loading">
        <div class="skeleton-line skeleton-line--long"></div>
        <div class="skeleton-line skeleton-line--long"></div>
        <div class="skeleton-line skeleton-line--long"></div>
      </div>
    </ng-template>
  </mat-card>
</div>
