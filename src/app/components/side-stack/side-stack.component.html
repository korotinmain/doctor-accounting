<div class="side-stack">
  <!-- ══ Card 1: Статистика по днях ══════════════════════════════════ -->
  <mat-card class="sc-card sc-card--stats">
    <header class="sc-header">
      <div class="sc-title-group">
        <h3 class="sc-title">Статистика по днях</h3>
        <p class="sc-sub" *ngIf="!monthLoading">
          {{ activeDaysCount }} {{ activeDaysCount === 1 ? 'активний день' : 'активних дні(в)' }} за місяць
        </p>
        <span class="sc-sub sc-sub--skeleton" *ngIf="monthLoading"></span>
      </div>
      <button type="button" class="sc-more" aria-label="Більше">
        <mat-icon>more_vert</mat-icon>
      </button>
    </header>

    <ng-container *ngIf="!monthLoading; else statsCardSkeleton">
      <ul class="sc-stat-list">
        <li class="sc-stat-item">
          <span class="sc-stat-icon sc-stat-icon--gold">
            <mat-icon>emoji_events</mat-icon>
          </span>
          <span class="sc-stat-text"
            >Найприбутковіший день &mdash; <strong>{{ bestProfitableDay }}</strong></span
          >
        </li>
        <li class="sc-stat-item">
          <span class="sc-stat-icon sc-stat-icon--blue">
            <mat-icon>bar_chart</mat-icon>
          </span>
          <span class="sc-stat-text"
            >Середній % &mdash; <strong class="sc-accent">{{ avgIncomePercent }}%</strong></span
          >
        </li>
        <li class="sc-stat-item">
          <span class="sc-stat-icon sc-stat-icon--amber">
            <mat-icon>circle</mat-icon>
          </span>
          <span class="sc-stat-text"
            ><strong class="sc-accent">{{ topProcedure.percent }}%</strong> доходу &mdash; {{ topProcedure.name }}</span
          >
        </li>
      </ul>
    </ng-container>

    <ng-template #statsCardSkeleton>
      <div class="sc-skeleton-list">
        <div class="skeleton-line skeleton-line--long"></div>
        <div class="skeleton-line skeleton-line--long"></div>
        <div class="skeleton-line skeleton-line--long"></div>
      </div>
    </ng-template>
  </mat-card>

  <!-- ══ Card 2: Активність за місяць ═══════════════════════════════ -->
  <mat-card class="sc-card sc-card--activity">
    <header class="sc-header">
      <div class="sc-title-group">
        <h3 class="sc-title">Активність за місяць</h3>
        <p class="sc-sub">{{ calendarMonthLabel }}</p>
      </div>
      <button type="button" class="sc-more" aria-label="Більше">
        <mat-icon>more_vert</mat-icon>
      </button>
    </header>

    <ng-container *ngIf="!monthLoading; else activitySkeleton">
      <!-- Weekday labels -->
      <div class="ac-weekdays">
        <span *ngFor="let label of weekdayLabels">{{ label }}</span>
      </div>

      <!-- Week rows -->
      <div class="ac-weeks">
        <div class="ac-week" *ngFor="let week of calendarWeeks; trackBy: trackByWeek">
          <button
            *ngFor="let cell of week.cells; trackBy: trackByCell"
            type="button"
            class="ac-cell"
            [class.ac-cell--empty]="cell.type === 'empty'"
            [class.ac-cell--has-visits]="cell.type === 'day' && cell.hasVisits"
            [class.ac-cell--today]="cell.type === 'day' && cell.isToday && !isDaySelected(cell.day)"
            [class.ac-cell--selected]="cell.type === 'day' && isDaySelected(cell.day)"
            [disabled]="cell.type === 'empty' || (cell.type === 'day' && !cell.hasVisits && !cell.isToday)"
            [attr.data-amount]="
              cell.type === 'day' && cell.hasVisits
                ? (getDayTotal(cell.day) | currency: 'UAH' : 'symbol' : '1.0-0' : 'uk-UA')
                : null
            "
            (click)="cell.type === 'day' && (cell.hasVisits || cell.isToday) && selectDay(cell.day)"
          >
            <ng-container *ngIf="cell.type === 'day'">{{ cell.day }}</ng-container>
          </button>
        </div>
      </div>

      <!-- Action buttons -->
      <div class="ac-actions">
        <button type="button" class="ac-btn ac-btn--primary" (click)="exportRequested.emit()">
          <mat-icon>upload</mat-icon>
          {{ exportFormat === 'excel' ? 'Експорт у Excel' : 'Експорт у CSV' }}
        </button>
        <button type="button" class="ac-btn" (click)="printReport()">
          <mat-icon>history</mat-icon>
          Друк звіту
        </button>
      </div>
    </ng-container>

    <ng-template #activitySkeleton>
      <div class="sc-skeleton-list">
        <div class="skeleton-line skeleton-line--long"></div>
        <div class="skeleton-line skeleton-line--long"></div>
        <div class="skeleton-line skeleton-line--long"></div>
        <div class="skeleton-line skeleton-line--long"></div>
      </div>
    </ng-template>
  </mat-card>
</div>
