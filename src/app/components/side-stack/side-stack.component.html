<div class="side-stack">
  <!-- ══ Card 1: Статистика по днях ══════════════════════════════════ -->
  <mat-card class="sc-card sc-card--stats">
    <header class="sc-header">
      <div class="sc-title-group">
        <h3 class="sc-title">Статистика по днях</h3>
        <p class="sc-sub" [class.sc-sub--skeleton]="monthLoading">
          {{ activeDaysCount }} {{ activeDaysCount === 1 ? 'активний день' : 'активних дні(в)' }} за місяць
        </p>
      </div>
    </header>

    <div class="sc-stats-body" [class.sc-stats-body--loading]="monthLoading">
      <ng-container *ngIf="activeDaysCount > 0; else statsEmpty">
        <ul class="sc-stat-list">
          <li class="sc-stat-item">
            <span class="sc-stat-icon sc-stat-icon--gold">
              <mat-icon>emoji_events</mat-icon>
            </span>
            <span class="sc-stat-text"
              >Найприбутковіший день &mdash; <strong>{{ bestProfitableDay }}</strong></span
            >
          </li>
          <li class="sc-stat-item">
            <span class="sc-stat-icon sc-stat-icon--blue">
              <mat-icon>bar_chart</mat-icon>
            </span>
            <span class="sc-stat-text"
              >Середній % &mdash; <strong class="sc-accent">{{ avgIncomePercent }}%</strong></span
            >
          </li>
          <li class="sc-stat-item">
            <span class="sc-stat-icon sc-stat-icon--amber">
              <mat-icon>radio_button_checked</mat-icon>
            </span>
            <span class="sc-stat-text"
              ><strong class="sc-accent">{{ topProcedure.percent }}%</strong> доходу &mdash;
              {{ topProcedure.name }}</span
            >
          </li>
        </ul>
      </ng-container>

      <ng-template #statsEmpty>
        <div class="sc-empty">
          <mat-icon>bar_chart</mat-icon>
          <p>Записів за цей місяць ще немає</p>
        </div>
      </ng-template>
    </div>
  </mat-card>

  <!-- ══ Card 2: Активність за місяць ═══════════════════════════════ -->
  <mat-card class="sc-card sc-card--activity">
    <header class="sc-header">
      <div class="sc-title-group">
        <h3 class="sc-title">Активність за місяць</h3>
        <p class="sc-sub">{{ calendarMonthLabel }}</p>
      </div>
    </header>

    <div class="sc-activity-body" [class.sc-activity-body--loading]="monthLoading">
      <!-- Weekday labels -->
      <div class="ac-weekdays">
        <span *ngFor="let label of weekdayLabels">{{ label }}</span>
      </div>

      <!-- Week rows -->
      <div class="ac-weeks">
        <div class="ac-week" *ngFor="let week of calendarWeeks; trackBy: trackByWeek">
          <button
            *ngFor="let cell of week.cells; trackBy: trackByCell"
            type="button"
            class="ac-cell"
            [class.ac-cell--empty]="cell.type === 'empty'"
            [class.ac-cell--has-visits]="cell.type === 'day' && cell.hasVisits"
            [class.ac-cell--today]="cell.type === 'day' && cell.isToday && !isDaySelected(cell.day)"
            [class.ac-cell--selected]="cell.type === 'day' && isDaySelected(cell.day)"
            [disabled]="cell.type === 'empty' || (cell.type === 'day' && !cell.hasVisits && !cell.isToday)"
            [attr.data-amount]="
              cell.type === 'day' && cell.hasVisits
                ? (getDayTotal(cell.day) | currency: 'UAH' : 'symbol' : '1.0-0' : 'uk-UA')
                : null
            "
            (click)="cell.type === 'day' && (cell.hasVisits || cell.isToday) && selectDay(cell.day)"
          >
            <ng-container *ngIf="cell.type === 'day'">{{ cell.day }}</ng-container>
          </button>
        </div>
      </div>

      <!-- Action buttons -->
      <div class="ac-actions">
        <button
          type="button"
          class="ac-btn ac-btn--primary"
          (click)="exportRequested.emit()"
          [disabled]="!visits.length"
        >
          <mat-icon>file_download</mat-icon>
          {{ exportFormat === 'excel' ? 'Excel' : 'CSV' }}
        </button>
        <button type="button" class="ac-btn" (click)="printReport()">
          <mat-icon>print</mat-icon>
          Друк звіту
        </button>
      </div>
    </div>
  </mat-card>
</div>
